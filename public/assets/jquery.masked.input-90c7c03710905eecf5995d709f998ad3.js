/*
	Masked Input plugin for jQuery
	Copyright (c) 2007-2011 Josh Bush (digitalbush.com)
	Licensed under the MIT license (http://digitalbush.com/projects/masked-input-plugin/#license) 
	Version: 1.3
*/
(function(e){var t=(e.browser.msie?"paste":"input")+".mask",n=window.orientation!=undefined;e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn"},e.fn.extend({caret:function(e,t){if(this.length!=0){if(typeof e=="number")return t=typeof t=="number"?t:e,this.each(function(){if(this.setSelectionRange)this.setSelectionRange(e,t);else if(this.createTextRange){var n=this.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select()}});if(this[0].setSelectionRange)e=this[0].selectionStart,t=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var n=document.selection.createRange();e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length}return{begin:e,end:t}}},unmask:function(){return this.trigger("unmask")},mask:function(r,i){if(!r&&this.length>0){var s=e(this[0]);return s.data(e.mask.dataName)()}i=e.extend({placeholder:"_",completed:null},i);var o=e.mask.definitions,u=[],f=r.length,l=null,h=r.length;return e.each(r.split(""),function(e,t){t=="?"?(h--,f=e):o[t]?(u.push(new RegExp(o[t])),l==null&&(l=u.length-1)):u.push(null)}),this.trigger("unmask").each(function(){function s(e){var t=T.val(),n=-1;for(var r=0,s=0;r<h;r++)if(u[r]){N[r]=i.placeholder;while(s++<t.length){var o=t.charAt(s-1);if(u[r].test(o)){N[r]=o,n=r;break}}if(s>t.length)break}else N[r]==t.charAt(s)&&r!=f&&(s++,n=r);if(!e&&n+1<f)T.val(""),v(0,h);else if(e||n+1>=f)p(),e||T.val(T.val().substring(0,n+1));return f?r:l}function p(){return T.val(N.join("")).val()}function v(e,t){for(var n=e;n<t&&n<h;n++)u[n]&&(N[n]=i.placeholder)}function m(e){var t=e.which,n=T.caret();if(e.ctrlKey||e.altKey||e.metaKey||t<32)return!0;if(t){n.end-n.begin!=0&&(v(n.begin,n.end),E(n.begin,n.end-1));var r=x(n.begin-1);if(r<h){var s=String.fromCharCode(t);if(u[r].test(s)){w(r),N[r]=s,p();var o=x(r);T.caret(o),i.completed&&o>=h&&i.completed.call(T)}}return!1}}function y(e){var t=e.which;if(t==8||t==46||n&&t==127){var r=T.caret(),i=r.begin,o=r.end;return o-i==0&&(i=t!=46?S(i):o=x(i-1),o=t==46?x(o):o),v(i,o),E(i,o-1),!1}if(t==27)return T.val(C),T.caret(0,s()),!1}function w(e){for(var t=e,n=i.placeholder;t<h;t++)if(u[t]){var r=x(t),s=N[t];N[t]=n;if(!(r<h&&u[r].test(s)))break;n=s}}function E(e,t){if(!(e<0)){for(var n=e,r=x(t);n<h;n++)if(u[n]){if(!(r<h&&u[n].test(N[r])))break;N[n]=N[r],N[r]=i.placeholder,r=x(r)}p(),T.caret(Math.max(l,e))}}function S(e){while(--e>=0&&!u[e]);return e}function x(e){while(++e<=h&&!u[e]);return e}var T=e(this),N=e.map(r.split(""),function(e,t){if(e!="?")return o[e]?i.placeholder:e}),C=T.val();T.data(e.mask.dataName,function(){return e.map(N,function(e,t){return u[t]&&e!=i.placeholder?e:null}).join("")}),T.attr("readonly")||T.one("unmask",function(){T.unbind(".mask").removeData(e.mask.dataName)}).bind("focus.mask",function(){C=T.val();var t=s();p();var n=function(){t==r.length?T.caret(0,t):T.caret(t)};(e.browser.msie?n:function(){setTimeout(n,0)})()}).bind("blur.mask",function(){s(),T.val()!=C&&T.change()}).bind("keydown.mask",y).bind("keypress.mask",m).bind(t,function(){setTimeout(function(){T.caret(s(!0))},0)}),s()})}})})(jQuery);